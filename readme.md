# ASO Mission Framework 2.2.1

Make persistent ArmA 3 missions easy and fast. This Framework helps you to setup a mission that is not only easy to create, but will also persist the mission state, so that it can be finished in more than one sitting. Please keep in mind that this Framework ist intended to be used in conjunction with [ACE](https://github.com/acemod/ACE3), [iniDBI2](https://github.com/code34/inidbi2) and the [VCOM AI](https://github.com/genesis92x/VcomAI-3.0). So if you have any question on how to use those mods, take a look at their repositories.

## Table of Contents

- [Setup](#Setup)
- [Features](#features)
- [Documentation](#documentation)
- [License](#license)
---

## Setup

You can use this repository as a sample mission, which takes place on the island Stratis. It uses all the important features of this framework and can be used as a template for a whole range of missions.

### Clone

Clone this repo to your local machine using `https://github.com/ASO-Squad/ASO_Mission_Framework.git`

### Getting started

- Use the ArmA 3 editor to create a new Mission on Stratis. Leave the mission empty for now and save it under some name.

- Go to your mission folder and copy the contents of the repository into the folder you have just created using the editor.

- Make sure to copy the VCOM AI Scripts as well, if you are going to use the scripted version of VCOM AI.

- Load the updated mission into the editor and explore the sample mission.
---

## Features

The Framework allows for missions to persist over multiple session that includes:

- Mission State 
    - Date and Time
    - Weather
    - Map markers
    - Items dropped on the ground
- Vehicles
    - Damage
    - Weapons and Ammo
    - Cargo
    - Passengers & Crew
- AI Groups
    - Position
    - Waypoints
    - Loadout
    - Health
- Player
    - Position
    - Loadout
    - Health

The Framework also provides a easy to use way to let AI groups patrol or guard a certain area. Those functions relay mostly on the CBA AI functions and their only purpose is to make your life as a mission builder easier. 

## Documentation

A good way to start, ist to use the template mission provided with this framework to see how things are supposed to be done. Additionally all functions inside this framework are documented and can be reviewed with the function viewer of the ArmA 3 editor.

### Initialization
This framework relies on some variables to work properly. Those variables are set in the file *ASO\Misc\fn_init_aso.sqf* please do not edit this file below the first three lines. Depending on your mission it might be a good idea to change the first three lines.

```sqf
ASO_PREFIX = "my_prefix"
```
This line is the most important one. Make sure every mission you build has a unique **ASO_PREFIX** set. That prefix is used to identify which dataset to use for which mission.

```sqf
ASO_DYNAMICSIM = true;
```
With this variable set to true, your AI groups are configured to use dynamic simulation, which helps to improve server performance and avoids lag for your players. If you don't know about the dynamic simulation feature of ArmA take a look [here](https://community.bistudio.com/wiki/Arma_3_Dynamic_Simulation)

```sqf
ASO_USE_TFR = true;
```
Set this one true, if you or your group is using Task Force Radio. If you set this variable true without actually using TFR, your players won't get their loadout loaded.

### Persistence
All functions needed to provide persistence are found in the ASO\Persistence folder. Generally, you should only use the functions found in that specific folder. Those scripts cover 90% of all things you will ever need. There is also a folder with convenient functions that can be found at ASO\Persistence\Helper, use them if needed. You should however never touch the functions found in ASO\Persistence\Private ... unless you know what you are doing.

The sample mission makes use of various [event scripts](https://community.bistudio.com/wiki/Event_Scripts), make sure to familiarize yourself with those scripts.

#### What to collect?
Every object, vehicle, AI or player you want to be persistent has to be collected by the framework. You can do that by using the collect helper functions. Those helper functions are meant to be executed in the init-field of each entity.

```sqf
[this] call aso_fnc_collectGroup;
```
For AI groups, you can either give them one of the tasks, or use this helper function.

```sqf
[this] call aso_fnc_collectCrate;
```
This function is meant to be used for ammo crates. Make sure to name each crate. 

```sqf
[this] call aso_fnc_collectObject;
```
This function ist meant to be used on objects that are important for the mission. Like objectives and stuff that you want to keep track of.

```sqf
[this] call aso_fnc_collectVehicle;
```
This function is meant for the vehicles in your mission. Make sure to name each vehicle. Vehicles that are part of a already collected group, **do not** need to be collected seperatly.


#### Save a Mission
If you want to save a mission, make sure the server has iniDBI2 installed. Then call the follwing on the server:

```sqf
[true] call aso_fnc_saveState;
```
That code saves all AI and player data and ends the mission afterwards for all players.

#### Load a Mission
If you want to load a mission state, make sure the server has iniDBI2 installed. Then call the follwing on the server:

```sqf
[] call aso_fnc_loadState;
```
That code loads all AI and object data. It is a good idea to execute this code in the event script *initServer*

#### Load a Player
If you want to load a player, make sure to execute the following code on the server machine. *_unit* is the player that you want to load. 

```sqf
[[_unit], false, false] call aso_fnc_executeLoadMan;
```
In the sample mission the code is executed in the event script *initPlayerServer*. Make sure that you understand the implications of that before using this script on a public server.

### Tasks

There are five tasks you can give to your AI groups. Those tasks are meant to give your AI some randomness and provide easy access to some pretty nice CBA AI functions. They also prepare the groups for persistance.

>Put the following lines of code in the init-fields of the whole group. They are not meant for single AI. Take a look at the files for more options and optional parameters

```sqf
[this] spawn aso_fnc_garrison;
```
This tasks is used to make the group act like a garrison. All units will enter nearby buildings or static weapons and they will stay there and defend the area.
> Please sychronize the groups leader with a trigger to provide a location and radius for this task.

```sqf
[this] call aso_fnc_guard;
```
This tasks is used to make the group defend a location. Some units will enter nearby buildings or static weapons, others will patrol the area.
> Please sychronize the groups leader with a trigger to provide a location and radius for this task.

```sqf
[this] call aso_fnc_patrol;
```
This tasks is used to make the group patrol a certain area.
> Please sychronize the groups leader with a trigger to provide a location and radius for this task.

```sqf
[this] call aso_fnc_patrolCity;
```
This tasks is used to make the group patrol a city. They will also search nearby houses at random.
> Please sychronize the groups leader with a trigger to provide a location and radius for this task.

```sqf
[this] call aso_fnc_stationary;
```
This task can be used to place the units of an AI group by hand and make them stay there. This can be usefull if you want some units to guard a certain entry or a building. By default they will move if they encounter enemies.

---

## License

**[GNU GENERAL PUBLIC LICENSE](http://www.gnu.org/licenses/gpl-3.0.txt)**